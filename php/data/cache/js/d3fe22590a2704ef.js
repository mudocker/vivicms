$(function(){$("[data-toggle=tooltip]").tooltip();$("body").on("click","[data-login=require]",function(event){if(Think.cookie("user_id")>0){return true}$("#loginModal").modal("show");return false});$("body").on("click","[data-toggle=face]",function(event){if(!$("#sinaEmotion").is(":visible")){$(this).sinaEmotion();event.stopPropagation()}});$("[data-toggle=parseface]").parseEmotion();$(".attach a").click(function(){$.get("/file/download",{id:$(this).data("id")})});if($(".footer-tools").size()>0){$(window).on("resize",function(){if(($(window).width()-$(".container").width())/2>60){$(".footer-tools").css("right",($(window).width()-$(".container").width())/2-50)}else{$(".footer-tools").css("right",10)}});$(window).trigger("resize");$(".footer-tools .icon-fanhuidingbu").click(function(){$("body,html").animate({scrollTop:0},500);return false})}$(".login__register-btn").click(function(){$(".register-section").slideUp();$(".login-section").slideDown()});$(".register__login-btn").click(function(){$(".login-section").slideUp();$(".register-section").slideDown()});if($("#loginBtn").length>0){$.get(Think.U("User/getInfo"),{},function(data){if(data.status){$("#loginBtn").remove();$("#loginInfo").find(".avatar img").attr("src",data.info);$("#loginInfo").show();ajaxGetNotify();setInterval("ajaxGetNotify()",parseInt(120*1000))}else{$("#loginInfo").remove();$("#loginBtn").show();if(is_weixin()){$.thinkbox.confirm("检测到您正使用微信客户端访问极思维，我们推荐您使用微信帐号快速登录极思维。",{callback:function(){window.location.href=data.url}})}}},"json")}$("[data-toggle='ajaxform']").submit(function(){var $button=$(this).find("[type='submit']");$button.button("loading");var target=$(this).attr("action")||window.location.href;var data=$(this).serializeArray();$.post(target,data,function(res){if(res.status===1){check_exit=false;if(res.eval){eval(res.eval)}if(res.url){if(res.info){$.thinkbox.success(res.info);setTimeout(function(){if(res.url==="reload"){window.location.reload()}else{window.location.href=res.url}},2000)}else{if(res.url==="reload"){window.location.reload()}else{window.location.href=res.url}}}else{$.thinkbox.success(res.info);$button.button("reset")}}else{$.thinkbox.error(res.info);$button.button("reset")}});return false});$("body").on("click","[data-toggle='confirm']",function(){var $this=$(this);$.thinkbox.confirm($this.data("msg"),{callback:function(){window.location.href=$this.attr("href")}});return false});if($.fn.lazyload){$("img.lazy").lazyload({skip_invisible:false})}var scrollTop=0;$(window).on("scroll",function(){if($(".footer-tools").size()>0){if($(window).scrollTop()>$(window).height()/2){$(".footer-tools .icon-fanhuidingbu").css("display","block")}else{$(".footer-tools .icon-fanhuidingbu").css("display","none")}}if(scrollTop===0){scrollTop=$(window).scrollTop()}if(Math.abs($(window).scrollTop()-scrollTop)>5){if($(window).scrollTop()-scrollTop>0){$(".navbar-fixed-top").css("position","absolute")}else{$(".navbar-fixed-top").css("position","fixed")}scrollTop=0}});$("body").on("click",".attention",function(){var $this=$(this);if(!$(this).hasClass("disabled")){$this.button("loading");$.get(Think.U("User/addAttention"),{uid:$this.data("uid")},function(data){if(data.status){$this.attr("class","btn btn-xs attention btn-default disabled");$this.removeAttr("disabled");$this.html('<em class="glyphicon glyphicon-ok"></em> 已关注 | <a href="javascript:;">取消</a>')}else{$this.button("reset");$.thinkbox.error(data.info)}},"json");return false}});$("body").on("click",".attention.disabled a",function(){var $this=$(this).parent();$.get(Think.U("User/delAttention"),{uid:$this.data("uid")},function(data){if(data.status){$this.attr("class","btn btn-xs btn-success attention");$this.html('<em class="glyphicon glyphicon-plus"></em> 关注此人')}else{$.thinkbox.error(data.info)}},"json");return false});+function(){$.get(Think.U("User/checkAttention"),{},function(list){$(".attention").each(function(){if($.inArray($(this).data("uid").toString(),list)>=0){$(this).attr("class","btn btn-xs attention btn-default disabled");$(this).html('<em class="glyphicon glyphicon-ok"></em> 已关注 | <a href="javascript:;">取消</a>')}})},"json")}();$("body").on("click",".addgroup",function(){var $this=$(this);if(!$(this).hasClass("disabled")){$this.button("loading");$.get(Think.U("Group/add"),{gid:$this.data("gid")},function(data){if(data.status){$this.attr("class","btn btn-xs addgroup btn-default disabled");$this.removeAttr("disabled");$this.html('<em class="glyphicon glyphicon-ok"></em> 已加入 | <a href="javascript:;">退出</a>')}else{$this.button("reset");$.thinkbox.error(data.info)}},"json");return false}});$("body").on("click",".addgroup.disabled a",function(){var $this=$(this).parent();$.get(Think.U("Group/out"),{gid:$this.data("gid")},function(data){if(data.status){$this.attr("class","btn btn-xs btn-success addgroup");$this.html('<em class="glyphicon glyphicon-plus"></em> 加入小组')}else{$.thinkbox.error(data.info)}},"json");return false});$.get(Think.U("User/checkGroup"),{},function(list){$(".addgroup").each(function(){if($.inArray($(this).data("gid").toString(),list)>=0){$(this).attr("class","btn btn-xs addgroup btn-default disabled");$(this).html('<em class="glyphicon glyphicon-ok"></em> 已加入 | <a href="javascript:;">退出</a>')}})},"json");var figurecard={};var figuretimer;var arrowcss="";var arrowcss_temp="";$("body").on("mouseenter","a[data-toggle='figurecard']",function(){if(figuretimer){clearTimeout(figuretimer)}var $this=$(this);var $img=$(this).children("img");var $win=$(".figurecard");if($img.length===0){$img=$this}var uid=$(this).data("uid");figuretimer=setTimeout(function(){if(figurecard[uid]){$win.children(".popover-content").html(figurecard[uid])}else{$win.children(".popover-content").html('<div class="loading"><img src="/Public/Home/images/loading.gif" width="12" alt="">正在加载中，请稍候...</div>');$.get(Think.U("User/getUserCard"),{uid:uid},function(minicard){if(minicard){figurecard[uid]=$(minicard);$win.children(".popover-content").html(figurecard[uid])}},"html")}arrowcss_temp="";if($(window).width()-$img.offset().left-$img.width()<370){$win.css({right:$(window).width()-$img.offset().left-$img.width()/2-41+"px",left:"auto"});arrowcss_temp+="right"}else{$win.css({left:$img.offset().left+$img.width()/2-41+"px",right:"auto"});arrowcss_temp+="left"}if($img.offset().top-$(window).scrollTop()<220){$win.css({top:$img.offset().top+$img.height()+12+"px",bottom:"auto"});arrowcss_temp+="bottom"}else{$win.css({bottom:$(window).height()-$img.offset().top+12+"px",top:"auto"});arrowcss_temp+="top"}$win.removeClass(arrowcss).addClass(arrowcss_temp);arrowcss=arrowcss_temp;$win.show().hover(function(){clearTimeout(figuretimer);$(this).show()},function(){clearTimeout(figuretimer);figuretimer=setTimeout(function(){if($win){$win.hide()}},200)})},500);$this.one("mouseleave",function(){clearTimeout(figuretimer);figuretimer=setTimeout(function(){if($win){$win.hide()}},200)})})});function is_weixin(){var a=navigator.userAgent.toLowerCase();if(a.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}function openwin(c){var d=650;var a=500;var g=(screen.width-d)/2;var f=(screen.height-a)/2;var b=$(c).attr("href");var e=window.open("about:blank","sns","scrollbars=no,resizable=yes,dependent=yes,statebar=no,location=no,width="+d+",height="+a+",left="+g+",top="+f);e.location=b;e.focus()}function placeholderIE(c,b,a){if(window.ActiveXObject){$(c).find(".placeholder_ie  i").css({marginTop:b,marginLeft:a});$(c).find(".placeholder_ie  i").show();$(c).find(".placeholder_ie  input").keydown(function(){$(this).parent("div").find("i").hide()});$(c).find(".placeholder_ie  i").blur(function(){if($(this).val()==""){$(this).parent("div").find("i").show()}})}}function moveEnd(c){c.focus();var a=c.value.length;if(document.selection){var b=c.createTextRange();b.moveStart("character",a);b.collapse();b.select()}else{if(typeof c.selectionStart=="number"&&typeof c.selectionEnd=="number"){c.selectionStart=c.selectionEnd=a}}}function date(i,e){var h,g=((e)?new Date(e*1000):new Date());var b=function(f,a){if((f=f+"").length<a){return new Array(++a-f.length).join("0")+f}else{return f}};var k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var j={1:"st",2:"nd",3:"rd",21:"st",22:"nd",23:"rd",31:"st"};var c=["","January","February","March","April","May","June","July","August","September","October","November","December"];var d={d:function(){return b(d.j(),2)},D:function(){return d.l().substr(0,3)},j:function(){return g.getDate()},l:function(){return k[d.w()]},N:function(){return d.w()+1},S:function(){return j[d.j()]?j[d.j()]:"th"},w:function(){return g.getDay()},z:function(){return(g-new Date(g.getFullYear()+"/1/1"))/86400000>>0},W:function(){var l=d.z(),f=364+d.L()-l;var m,n=(new Date(g.getFullYear()+"/1/1").getDay()||7)-1;if(f<=2&&((g.getDay()||7)-1)<=2-f){return 1}else{if(l<=2&&n>=4&&l>=(6-n)){m=new Date(g.getFullYear()-1+"/12/31");return date("W",Math.round(m.getTime()/1000))}else{return(1+(n<=3?((l+n)/7):(l-(7-n))/7)>>0)}}},F:function(){return c[d.n()]},m:function(){return b(d.n(),2)},M:function(){return d.F().substr(0,3)},n:function(){return g.getMonth()+1},t:function(){var a;if((a=g.getMonth()+1)==2){return 28+d.L()}else{if(a&1&&a<8||!(a&1)&&a>7){return 31}else{return 30}}},L:function(){var a=d.Y();return(!(a&3)&&(a%100||!(a%400)))?1:0},Y:function(){return g.getFullYear()},y:function(){return(g.getFullYear()+"").slice(2)},a:function(){return g.getHours()>11?"pm":"am"},A:function(){return d.a().toUpperCase()},B:function(){var l=(g.getTimezoneOffset()+60)*60;var a=(g.getHours()*3600)+(g.getMinutes()*60)+g.getSeconds()+l;var f=Math.floor(a/86.4);if(f>1000){f-=1000}if(f<0){f+=1000}if((String(f)).length==1){f="00"+f}if((String(f)).length==2){f="0"+f}return f},g:function(){return g.getHours()%12||12},G:function(){return g.getHours()},h:function(){return b(d.g(),2)},H:function(){return b(g.getHours(),2)},i:function(){return b(g.getMinutes(),2)},s:function(){return b(g.getSeconds(),2)},O:function(){var a=b(Math.abs(g.getTimezoneOffset()/60*100),4);if(g.getTimezoneOffset()>0){a="-"+a}else{a="+"+a}return a},P:function(){var a=d.O();return(a.substr(0,3)+":"+a.substr(3,2))},c:function(){return d.Y()+"-"+d.m()+"-"+d.d()+"T"+d.h()+":"+d.i()+":"+d.s()+d.P()},U:function(){return Math.round(g.getTime()/1000)}};return i.replace(/[\\]?([a-zA-Z])/g,function(a,f){if(a!=f){ret=f}else{if(d[f]){ret=d[f]()}else{ret=f}}return ret})}function windowsNotify(d,c,b,a,e){if(!("Notification" in window)&&!window.webkitNotifications&&window.webkitNotifications.checkPermission()!==0){return}if(Notification.permission===null||Notification.permission===undefined){windowsNotify360(d,c,b,a,e)}else{if(Notification.permission==="granted"){windowsNotifyFFAndGE(d,c,b,a,e)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(f){if(!("permission" in Notification)){Notification.permission=f}if(f==="granted"){windowsNotifyFFAndGE(d,c,b,a,e)}})}}}}function windowsNotify360(e,d,c,a,f){if(window.webkitNotifications&&window.webkitNotifications.checkPermission()===0){var b=window.webkitNotifications.createNotification(c,e,d);b.ondisplay=function(g){setTimeout(function(){g.currentTarget.cancel()},10000)};b.onclick=function(){window.focus();if(a){window.location.href=a}this.cancel()};if(f){b.replaceId=f}b.show()}else{if(window.webkitNotifications){window.webkitNotifications.requestPermission(windowsNotify360)}}}function windowsNotifyFFAndGE(e,c,b,a,f){var d=new Notification(e,{body:c,icon:b,tag:f});d.onshow=function(g){console.log(g);setTimeout(function(){console.log(g);d.close()},10000)};d.onclick=function(g){window.focus();if(a){window.location.href=a}d.close()}}function ajaxGetNotify(){$.get("/user/getNotifyCount",{},function(a){if(a.message!=0){$("#all_notify").text(a.message);$("#message_num").text("("+a.message+")");$("#all_notify").show();windowsNotify("极思维","有新的提醒，快去看看吧","/Public/Home/images/ji2.png","/user/notify.html","notice")}else{$("#all_notify").text("");$("#all_notify").hide()}},"json")};